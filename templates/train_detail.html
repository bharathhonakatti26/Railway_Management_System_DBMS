{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Train {{ train.train_no }} — {{ train.train_name }}</h2>
  <p>Route: {{ train.route_id }} | Type: {{ train.type }}</p>
  {% if date %}
  <p>Travel: {{ source }} → {{ destination }} on {{ date }}</p>
  {% else %}
  <p>Travel: {{ source }} → {{ destination }}</p>
  <h3>Select Travel Date</h3>
  {% if available_dates %}
  <div>
    {% for d in available_dates %}
    <a class="btn" href="{{ url_for('train_detail', train_no=train.train_no, source=source, destination=destination, date=d) }}">{{ d.strftime('%Y-%m-%d') }} ({{ d.strftime('%a') }})</a>
    {% endfor %}
  </div>
  {% else %}
  <p>No available dates found.</p>
  {% endif %}
  {% endif %}
</div>

{% if date %}
<div class="card">
  <h3>Classes & Availability</h3>
  {% if source != "any" and destination != "any" %}
  <table>
    <tr>
      <th>Class ID</th><th>Name</th><th>Coach Type</th><th>Seats Available</th><th></th>
    </tr>
    {% for c in classes %}
    <tr>
      <td>{{ c.class_id }}</td>
      <td>{{ c.class_name }}</td>
      <td>{{ c.coach_type }}</td>
      <td>{{ c.available }}</td>
      <td>
        <details>
          <summary>Book</summary>
          <form method="post" action="{{ url_for('book_train', train_no=train.train_no) }}">
            <input type="hidden" name="date" value="{{ date }}">
            <input type="hidden" name="source" value="{{ source }}">
            <input type="hidden" name="destination" value="{{ destination }}">
            <input type="hidden" name="class_id" value="{{ c.class_id }}">
            <label>Number of Passengers</label>
            <input name="num_passengers" type="number" min="1" max="{{ c.available }}" value="1" required>
            <label>Passenger Name</label>
            <input name="passenger_name" required>
            <label>Age</label>
            <input name="age" type="number" required>
            <label>Gender</label>
            <select name="gender">
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
            <button class="btn" type="submit">Confirm Booking</button>
          </form>
        </details>
      </td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>Booking is not available when source or destination is set to "Any". Please search with specific stations.</p>
  {% endif %}
</div>
{% endif %}
{% endblock %}
