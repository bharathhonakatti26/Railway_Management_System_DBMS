{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Search Trains</h2>
  <form method="get">
    <label>Source Station</label>
    <select name="source">
      <option value="any">Any</option>
      {% for station in stations %}
      <option value="{{ station['station_id'] }}" {% if request.args.get('source') == station['station_id'] %}selected{% endif %}>{{ station['station_name'] }} ({{ station['station_id'] }})</option>
      {% endfor %}
    </select>
    <label>Destination Station</label>
    <select name="destination">
      <option value="any">Any</option>
      {% for station in stations %}
      <option value="{{ station['station_id'] }}" {% if request.args.get('destination') == station['station_id'] %}selected{% endif %}>{{ station['station_name'] }} ({{ station['station_id'] }})</option>
      {% endfor %}
    </select>
    <button class="btn" type="submit">Find</button>
  </form>
</div>

{% if trains is not none %}
<div class="card">
  <h3>Available Trains</h3>
  {% if trains %}
    <table>
      <tr>
        <th>Train No</th>
        <th>Name</th>
        <th>Type</th>
        <th>Departs</th>
        <th>Arrives</th>
        <th></th>
      </tr>
      {% for row in trains %}
      <tr>
        <td>{{ row['train_no'] }}</td>
        <td>{{ row['train_name'] }}</td>
        <td>{{ row['type'] }}</td>
        <td>{{ row['source_departure'] or 'N/A' }}</td>
        <td>{{ row['destination_arrival'] or 'N/A' }}</td>
        <td><a class="btn" href="{{ url_for('train_detail', train_no=row['train_no'], source=request.args.get('source'), destination=request.args.get('destination')) }}">View</a></td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No trains found for your query.</p>
  {% endif %}
</div>
{% endif %}
{% endblock %}
